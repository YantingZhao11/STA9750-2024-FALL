---
title: "Mini-Project #01 Yanting Zhao"
---

```{r echo=FALSE}
# Load necessary libraries
if(!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)
library(readxl)

# Fare revenue file path
fare_revenue_file <- "C:\\Users\\w3038\\Downloads\\2022_fare_revenue.xlsx"

# Load fare revenue data
FARES <- readxl::read_xlsx(fare_revenue_file) |>
    select(-`State/Parent NTD ID`, 
           -`Reporter Type`,
           -`Reporting Module`,
           -`TOS`,
           -`Passenger Paid Fares`,
           -`Organization Paid Fares`) |>
    filter(`Expense Type` == "Funds Earned During Period") |>
    select(-`Expense Type`)

# Expenses file path
expenses_file <- "C:\\Users\\w3038\\Downloads\\2022_expenses.csv"

# Load expenses data
EXPENSES <- readr::read_csv(expenses_file) |>
    select(`NTD ID`, 
           `Agency`,
           `Total`, 
           `Mode`) |>
    mutate(`NTD ID` = as.integer(`NTD ID`)) |>
    rename(Expenses = Total) |>
    group_by(`NTD ID`, `Mode`) |>
    summarize(Expenses = sum(Expenses)) |>
    ungroup()

# Join fares and expenses data
FINANCIALS <- inner_join(FARES, EXPENSES, by = c("NTD ID", "Mode"))

# Monthly Transit Numbers
library(tidyverse)

# Expenses file path
ridership_file <- "C:\\Users\\w3038\\Downloads\\ridership.xlsx"

# Load Trips data (UPT)
TRIPS <- readxl::read_xlsx(ridership_file, sheet="UPT") |>
    filter(`Mode/Type of Service Status` == "Active") |>
    select(-`Legacy NTD ID`, 
           -`Reporter Type`, 
           -`Mode/Type of Service Status`, 
           -`UACE CD`, 
           -`TOS`) |>
    pivot_longer(-c(`NTD ID`:`3 Mode`), 
                 names_to="month", 
                 values_to="UPT") |>
    drop_na() |>
    mutate(month = my(month))  # Parse month-year date specs using lubridate

# Load Miles data (VRM)
MILES <- readxl::read_xlsx(ridership_file, sheet="VRM") |>
    filter(`Mode/Type of Service Status` == "Active") |>
    select(-`Legacy NTD ID`, 
           -`Reporter Type`, 
           -`Mode/Type of Service Status`, 
           -`UACE CD`, 
           -`TOS`) |>
    pivot_longer(-c(`NTD ID`:`3 Mode`), 
                 names_to="month", 
                 values_to="VRM") |>
    drop_na() |>
    group_by(`NTD ID`, `Agency`, `UZA Name`, `Mode`, `3 Mode`, month) |>
    summarize(VRM = sum(VRM)) |>
    ungroup() |>
    mutate(month = my(month))  # Parse month-year date specs using lubridate

# Join Trips and Miles data
USAGE <- inner_join(TRIPS, MILES) %>%
  mutate(`NTD ID` = as.integer(`NTD ID`))


if(!require("DT")) install.packages("DT")
library(DT)

sample_n(USAGE, 1000) |> 
    mutate(month=as.character(month)) |> 
    DT::datatable()

```
