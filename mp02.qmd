---
title: "Report 2"
---


```{r}

  if(!require("stringr")) install.packages("stringr")
library(stringr)

  if(!require("dplyr")) install.packages("dplyr")
library(dplyr)

get_imdb_file <- function(fname, path){
    fname_ext <- file.path(path, paste0(fname, "_small.csv"))
    as.data.frame(readr::read_csv(fname_ext, lazy=FALSE))
}

# Example usage: specify the path where your CSV files are stored
path <- "C:\\Users\\w3038\\Downloads\\STA 9750"

NAME_BASICS      <- get_imdb_file("name_basics", path)
TITLE_BASICS     <- get_imdb_file("title_basics", path)
TITLE_CREW       <- get_imdb_file("title_crew", path)
TITLE_EPISODES   <- get_imdb_file("title_episodes", path)
TITLE_PRINCIPALS <- get_imdb_file("title_principals", path)
TITLE_RATINGS <- get_imdb_file("title_ratings", path)

NAME_BASICS <- NAME_BASICS |> 
    filter(str_count(knownForTitles, ",") > 1)

TITLE_RATINGS <- TITLE_RATINGS |>
    filter(numVotes >= 100)

TITLE_BASICS <- TITLE_BASICS |>
    semi_join(TITLE_RATINGS, 
              join_by(tconst == tconst))

TITLE_CREW <- TITLE_CREW |>
    semi_join(TITLE_RATINGS, 
              join_by(tconst == tconst))

TITLE_EPISODES_1 <- TITLE_EPISODES |>
    semi_join(TITLE_RATINGS, 
              join_by(tconst == tconst))
TITLE_EPISODES_2 <- TITLE_EPISODES |>
    semi_join(TITLE_RATINGS, 
              join_by(parentTconst == tconst))

TITLE_EPISODES <- bind_rows(TITLE_EPISODES_1,
                            TITLE_EPISODES_2) |>
    distinct()

TITLE_PRINCIPALS <- TITLE_PRINCIPALS |>
    semi_join(TITLE_RATINGS, join_by(tconst == tconst))


rm(TITLE_EPISODES_1)
rm(TITLE_EPISODES_2)

NAME_BASICS <- NAME_BASICS |>
    mutate(birthYear = as.numeric(str_replace_all(birthYear, "[^0-9]", "")),
           deathYear = as.numeric(str_replace_all(deathYear, "[^0-9]", "")))

```